---
title: 'SG1022 Seminar 3: Using survey data'
author: "Christopher Gandrud"
date: '2016'
output:
  ioslides_presentation:
    css: https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css
    logo: https://raw.githubusercontent.com/christophergandrud/Hertie_Collab_Data_Science/master/img/HertieCollaborativeDataLogo_v1.png
---

## <i class="fa fa-arrow-circle-o-up"></i> Objectives

- Getting (local) data into R

- Working with factors (categorical data)

- Using R to analyse surveys (cross-tabs, $X^2$, grouped bar plots)

## <i class="fa fa-check"></i> Pop Quiz

-

## <i class="fa fa-bolt"></i> Importance of understanding files/file structures

- This topic may seem kind of . . . dry.

- Why not just click and drag files with the GUI (Graphical User Interface)?

## <i class="fa fa-bolt"></i> Importance of understanding files/file structures

- **Reproducibility**: other researchers only have your files. If they are **well
    organised** and the **links** between the files are **explicitly stated**
    then they can better understand what you did.

    + Clearest way of explicitly stating links is **dynamically** using file
    paths in your source code.

- **You**: well organised files will be easier for you to find/understand/use
    in the future.


## <i class="fa fa-folder-open-o"></i> File paths

- Files are organised **hierarchically** into (upside down) trees.

```{r eval=FALSE}
Root
|_
    Parent
    |_
        Child1
        Child2
```

## <i class="fa fa-folder-open-o"></i> Root

**Root** directories are the **first level of a disk**.

They are the root out of which the file tree grows.

**Naming Conventions**:

**Linux/Mac**: `/`

- e.g. `/git_repos` means that the `git_repos` directory is a child
of the root directory.

**Windows**: the disk is partitioned, e.g. the `C` partition is denoted `C:\`.

- `C:\git_repos` indicates that the `git_repos` directory is a child
of the `C` partition.

## <i class="fa fa-folder-open-o"></i> Sub (child) directories

Sub (child) directories are denoted with a `/` in Linux/Mac and `\` in Windows, e.g.:

```{r engine='sh', eval=FALSE}
# Linux/Mac
/git_repos/Project1

# Windows
C:\git_repos\Project1
```

<i class="fa fa-exclamation"></i> R tip:

- In R for Windows you either use two backslashes `\\` (`\` is the R [escape
character](http://en.wikipedia.org/wiki/Escape_character))

- Or `/` in **relative paths** in R for Windows, it will know
what you mean.

## <i class="fa fa-folder-open-o"></i> Working directories

A **working directory** is the directory where the program looks for files/other
directories.

<i class="fa fa-exclamation"></i> **Always remember the working directory.**

- Otherwise you may open/save files that you do not want to open/save.

## <i class="fa fa-folder-open-o"></i> Working directories

**In R:**

```{r}
# Find working directory
getwd()

# List all files in the working directory
list.files()
```

```{r, eval=FALSE}
# Set root as working directory
setwd('/')
```

## <i class="fa fa-folder-open-o"></i> Relative vs. Absolute file paths

Use **relative file paths** when possible.

- **Absolute file path**: the entire path on a particular system,
    + E.g. `/git_repos/Project1/data.csv`

- **Relative file path**: the path relative to the working directory.

    + E.g. if `/git_repos` is the working directory then the relative path for
    `data.csv` is `Project1/data.csv`.

Why?

- Your scripts will run easily on **other computers**. **Enhances reproducibility**.
Easier for your collaborators. Easier for you when you use another computer.

## <i class="fa fa-folder-open-o"></i> File & directory name conventions

<i class="fa fa-exclamation-triangle"></i> **Don't use spaces** in your file names.

They can create problems for programs that treat spaces as an indication that the
path has ended.

Alternatives:

- `CamelCase` (ex. `DataAnalysis.R`)

- `file_underscore` (ex. `data_analysis.R`)

## Loading data into R

R can load data from many different file formats (e.g. .sav (SPSS), .xlsx (Excel), .dta (Stata), .csv).

The [rio](https://github.com/leeper/rio) (R input/output) package makes it very easy to import many different types of data.

It has two key functions `import` and `export`.

## Rio `import` for loading data into R

```{r, warning=FALSE}
library(rio)
setwd('/git_repositories/city_sg1022/seminars/week_3/data/')

# Load ESS 5 (UK) only data from SPSS format
ess5_uk <- import('ESS5_UKonly.sav')

head(ess5_uk[1:3, 1:6])
```

# Note: Always look at the data you imported to see if it's what you think you imported/see what needs cleaning.

## Rio `export` for saving data

We can save the `ess5_uk` data into another format. For example, .csv "Comma Separated Values". Just add the csv file extension to the file name and `rio` does the rest.

```{r, eval=FALSE}
export(ess5_uk, 'ess5_uk.csv')
```

## Review: factors (categorical data)

In R, categorical data is coded using *factors*.

Imagine we have a data with three categories:

| Number Code | Label         |
| ----------- | ------------- |
| 1           | Low income    |
| 2           | Medium income |
| 3           | High income   |

## Factors

Imagine data is loaded into R just with the numbers:

```{r include=FALSE}
library(randomNames)
persons <- randomNames(n = 1000)
income <- sample(1:3, size = 1000, replace = T)
ex_income <- data.frame(persons, income)
ex_income$persons <- as.character(ex_income$persons)
```

```{r}
head(ex_income)
```

## Factor labels

To convert this variable to a factor and add labels use `factor`.

```{r}
income_labels <- c('Low income', 'Medium income', 'High income')

ex_income$income <- factor(ex_income$income, labels = income_labels)

summary(ex_income$income)
```

## Converting from character strings to factors (1)

Sometimes you will have data that is in character strings (R sees letters, but doesn't see any categories), but you want it to be categorical.

```{r}
summary(ex_income$persons)
```

## Converting from character strings to factors (2)

Simply run it through `as.factor`. R will turn it into a factor and use the character strings as factor labels.

```{r}
ex_income$persons <- as.factor(ex_income$persons)

summary(ex_income$persons)

```

## Frequency table (categorical variables)

```{r, message=FALSE}
library(MASS)
smoking_freq <- table(survey$Smoke)
smoking_freq
```

## Joint distributions (categorical variables)

Contingency table
```{r}
smoking <- table(survey$Smoke, survey$Exer)
smoking
```

## Reorder factors

You may want to **change the order** of a factor's variable's levels so that makes more substantive sense.

```{r}
# Relevel
survey$Smoke <- factor(survey$Smoke,
                       levels = c('Never', 'Occas', 'Regul', 'Heavy'))
survey$Exer <- factor(survey$Exer, levels = c('None', 'Some', 'Freq'))

# Re-create table
smoking <- table(survey$Smoke, survey$Exer)
smoking
```

## Cross-tabs with proportions

```{r}
prop.table(smoking, margin = 1) # row proportions

prop.table(smoking, margin = 2) # column proportions
```

## Plotting (grouped bar chart)--Base R

```{r}
barplot(smoking, beside = TRUE, xlab = 'Excercise Frequency',
    col = c('darkgreen', 'coral', 'coral2', 'coral4'),
    legend = rownames(smoking), args.legend = list(title = 'Smoking'))
```

## Colours in R

For a list of R colour names see: <http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf>

## Plotting Percentages--Base R (1)

To plot proportions (easier for cross-group comparability), first create a table of the proportions.

```{r}
prop_smoking <- prop.table(smoking, margin = 2) # column proportion

prop_smoking
```

## Plotting Percentages--Base R (2)

```{r}
barplot(prop_smoking, beside = TRUE, xlab = 'Excercise Frequency',
    col = c('darkgreen', 'coral', 'coral2', 'coral4'),
    legend = rownames(smoking), args.legend = list(title = 'Smoking'))
```

## Plotting Percentages--Base R (1)

To plot proportions (easier for cross-group comparability), first create a table of the proportions.

```{r}
# Convert to percentages
perc_smoking <- prop_smoking * 100

perc_smoking
```

## Plotting Percentages--Base R (2)

```{r}
barplot(perc_smoking, beside = TRUE, xlab = 'Excercise Frequency',
    col = c('darkgreen', 'coral', 'coral2', 'coral4'),
    legend = rownames(smoking), args.legend = list(title = 'Smoking'))
```

## Joint distributions (categorical variables)

$\chi^2$ Test
```{r, warning=FALSE}
chisq.test(smoking)

```

## <i class="fa fa-arrow-circle-o-up"></i> Seminar: Work with example survey data

- Set up a Qualtrics Survey.

- Administer survey to 2 fellow students

- Download data and import it into R.

- Create contingency tables and grouped bar charts.


## <i class="fa fa-arrow-up"></i> Plotting (grouped bar chart)--ggplot2

```{r}
library(ggplot2); ggplot(survey, aes(Exer, fill = Smoke)) +
    geom_bar(position = 'dodge') +
    xlab('Exercise Frequency') + theme_bw()
```
