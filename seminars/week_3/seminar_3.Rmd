---
title: 'SG1022 Seminar 2: Using survey data'
author: "Christopher Gandrud"
date: '2016'
output:
  ioslides_presentation:
    css: https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css
    logo: https://raw.githubusercontent.com/christophergandrud/Hertie_Collab_Data_Science/master/img/HertieCollaborativeDataLogo_v1.png
---

## <i class="fa fa-arrow-circle-o-up"></i> Objectives

- Working with factors (categorical data)

- Using R to analyse surveys (cross-tabs, $X^2$, grouped bar plots)

## <i class="fa fa-check"></i> Pop Quiz

-

## Review: factors (categorical data)

In R, categorical data is coded using *factors*.

Imagine we have a data with three categories:

| Number Code | Label         |
| ----------- | ------------- |
| 1           | Low income    |
| 2           | Medium income |
| 3           | High income   |

## Factors

Imagine data is loaded into R just with the numbers:

```{r include=FALSE}
library(randomNames)
persons <- randomNames(n = 1000)
income <- sample(1:3, size = 1000, replace = T)
ex_income <- data.frame(persons, income)
ex_income$persons <- as.character(ex_income$persons)
```

```{r}
head(ex_income)
```

## Factor labels

To convert this variable to a factor and add labels use `factor`.

```{r}
income_labels <- c('Low income', 'Medium income', 'High income')

ex_income$income <- factor(ex_income$income, labels = income_labels)

summary(ex_income$income)
```

## Converting from character strings to factors (1)

Sometimes you will have data that is in character strings (R sees letters, but doesn't see any categories), but you want it to be categorical.

```{r}
summary(ex_income$persons)
```

## Converting from character strings to factors (2)

Simply run it through `as.factor`. R will turn it into a factor and use the character strings as factor labels.

```{r}
ex_income$persons <- as.factor(ex_income$persons)

summary(ex_income$persons)

```

## Frequency table (categorical variables)

```{r, message=FALSE}
library(MASS)
smoking_freq <- table(survey$Smoke)
smoking_freq
```

## Joint distributions (categorical variables)

Contingency table
```{r}
smoking <- table(survey$Smoke, survey$Exer)
smoking
```

## Reorder factors

You may want to **change the order** of a factor's variable's levels so that makes more substantive sense.

```{r}
# Relevel
survey$Smoke <- factor(survey$Smoke,
                       levels = c('Never', 'Occas', 'Regul', 'Heavy'))
survey$Exer <- factor(survey$Exer, levels = c('None', 'Some', 'Freq'))

# Re-create table
smoking <- table(survey$Smoke, survey$Exer)
smoking
```

## Cross-tabs with proportions

```{r}
prop.table(smoking, margin = 1) # row proportions

prop.table(smoking, margin = 2) # column proportions
```

## Plotting (grouped bar chart)--Base R

```{r}
barplot(smoking, beside = TRUE, xlab = 'Excercise Frequency',
    col = c('darkgreen', 'coral', 'coral2', 'coral4'),
    legend = rownames(smoking), args.legend = list(title = 'Smoking'))
```

## Colours in R

For a list of R colour names see: <http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf>

## Plotting Percentages--Base R (1)

To plot proportions (easier for cross-group comparability), first create a table of the proportions.

```{r}
prop_smoking <- prop.table(smoking, margin = 2) # column proportion

prop_smoking
```

## Plotting Percentages--Base R (2)

```{r}
barplot(prop_smoking, beside = TRUE, xlab = 'Excercise Frequency',
    col = c('darkgreen', 'coral', 'coral2', 'coral4'),
    legend = rownames(smoking), args.legend = list(title = 'Smoking'))
```

## Plotting Percentages--Base R (1)

To plot proportions (easier for cross-group comparability), first create a table of the proportions.

```{r}
# Convert to percentages
perc_smoking <- prop_smoking * 100

perc_smoking
```

## Plotting Percentages--Base R (2)

```{r}
barplot(perc_smoking, beside = TRUE, xlab = 'Excercise Frequency',
    col = c('darkgreen', 'coral', 'coral2', 'coral4'),
    legend = rownames(smoking), args.legend = list(title = 'Smoking'))
```

## Joint distributions (categorical variables)

$\chi^2$ Test
```{r, warning=FALSE}
chisq.test(smoking)

```

## <i class="fa fa-arrow-circle-o-up"></i> Seminar: Work with example survey data

- Set up a Qualtrics Survey.

- Administer survey to 2 fellow students

- Download data and import it into R.

- Create contingency tables and grouped bar charts.


## <i class="fa fa-arrow-up"></i> Plotting (grouped bar chart)--ggplot2

```{r}
library(ggplot2); ggplot(survey, aes(Exer, fill = Smoke)) +
    geom_bar(position = 'dodge') +
    xlab('Exercise Frequency') + theme_bw()
```
